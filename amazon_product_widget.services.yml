services:
  amazon_product_widget.settings:
    class: Drupal\Core\Config\ImmutableConfig
    factory: config.factory:get
    arguments:
      - amazon_product_widget.settings
  amazon_product_widget.ajax_sanitizer.subscriber:
    class: Drupal\amazon_product_widget\EventSubscriber\AmazonApiSubscriber
    arguments: ['@current_route_match', '@amazon_product_widget.settings']
    tags:
      - { name: event_subscriber }
  amazon_product_widget.product_storage:
    class: Drupal\Core\KeyValueStore\KeyValueStoreExpirableInterface
    factory: keyvalue.expirable:get
    arguments: ['amazon_product_widget.products']
  amazon_product_widget.product_service:
    class: Drupal\amazon_product_widget\ProductService
    arguments: ['@amazon_product_widget.product_storage', '@lock', '@config.factory']
